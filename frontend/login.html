<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="./css/login.css" />
  </head>
  <body onkeydown="javascript:onEnterLogin(event);">
    <div class="main-box">
        <div class="title">
        
            <img src="../backend/img/Color_logo_-_no_background.png" class="title-img" alt="">
        </div>
        <div class="title2">Sign in</div>
        
        <div class="user-info">
        <label for="" class="user-label">ID</label><span id="undefinedID"></span><BR>
        <input type="text" id="user_id_input" ><br>
        <label for="" class="user-label">PASSWORD</label><span id="pwderr"></span>
        <input type="password" id="user_pw_input" name="user_pw"><br>
        <button id="btn">Sign in</button>
      </div>

      <div id="newto">New to Goodreads?</div>
      <div id="signupdiv">
        <a href="http://127.0.0.1:5500/frontend/signup.html" id="signup"
          >Create Account</a
        >
      </div>

      <div id="copy">© 2023 najakjak.Inc.</div>
    </div>


</body>
<script>
    btn.onclick = async ()=>{
        axios.post("http://127.0.0.1:8080/login",{

            withCredentials:true,

            data :{
                user_id : user_id_input.value,
                user_pw : user_pw_input.value,
            }
        })
        // console.log(data);
        // if(data =="1"){
        //     window.location.href="http://127.0.0.1:5501/frontend/index.html";
        // }
        .then((e) => {
          console.log(e);
          if (e.data.msg == "로그인 성공") {
            console.log(e.data.token);

            // document.cookie="";
            // console.log(document);
            // console.log("werwer");
            document.cookie = `mytoken=${e.data.token}; path=/`;
            // console.log(document.cookie);
            window.location.href = "http://127.0.0.1:5500/frontend/index.html";
          } else if (e.data == "어드민") {
            window.location.href = "http://127.0.0.1:5500/frontend/admin.html";
          } else if (e.data == "비밀번호 틀림") {
            undefinedID.innerText = "";
            pwderr.innerHTML = "wrong password";
            pwderr.style.color = "red";
          } else if (e.data == "존재하지 않는 계정") {
            pwderr.innerHTML = "";
            undefinedID.innerText = "account does not exist";
            undefinedID.style.color = "red";
          } else if (e.data == "승인되지 않은 계정") {
            pwderr.innerHTML = "";
            undefinedID.innerText = "";
            alert("승인되지 않은 계정입니다.");
          } else if (e.data == "승인거절") {
            pwderr.innerHTML = "";
            undefinedID.innerText = "";
            alert("승인이 거절된 아이디입니다.");
          }
        });
    };

    function onEnterLogin(event) {
      const keycode = event.key;
      console.log(keycode);
      if (keycode == "Enter") {
        axios
          .post("http://127.0.0.1:8080/login", {
            withCredentials: true,

            data: {
              user_id: user_id_input.value,
              user_pw: user_pw_input.value,
            },
          })
          .then((e) => {
            console.log(e);
            if (e.data == "로그인 성공") {
              window.location.href =
                "http://127.0.0.1:5500/frontend/index.html";
            } else if (e.data == "어드민") {
              window.location.href =
                "http://127.0.0.1:5500/frontend/admin.html";
            } else if (e.data == "비밀번호 틀림") {
              undefinedID.innerText = "";
              pwderr.innerHTML = "wrong password";
              pwderr.style.color = "red";
            } else if (e.data == "존재하지 않는 계정") {
              pwderr.innerHTML = "";
              undefinedID.innerText = "account does not exist";
              undefinedID.style.color = "red";
            } else if (e.data == "승인되지 않은 계정") {
              pwderr.innerHTML = "";
              undefinedID.innerText = "";
              alert("승인되지 않은 계정입니다.");
            } else if (e.data == "승인거절") {
              pwderr.innerHTML = "";
              undefinedID.innerText = "";
              alert("승인이 거절된 아이디입니다.");
            }
          });
      }
    }
  </script>
</html>
