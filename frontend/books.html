<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="./css/books.css">
</head>

<body>
    <div class="header">
        <a href="/index.html">
        <img class="header-img"
        src="https://cdn.discordapp.com/attachments/1114103044242677824/1115109195503648838/White_logo_-_no_background.png"
        alt=""></a>
        <div class="ulheader">
            <ul style="display: flex; align-items: center;">
                <li class="category"><a href="/index.html">Home</a></li>
                <li class="category"><a href="">My Books</a></li>
            </ul>
            <ul style="display: flex; align-items: center;">
                <button id="logout">Log-Out</button>
                
            </ul>
        </div>
    </div>
    <div class="main">
    <div class="content1">
    <h3>book cover</h3>
    <form>
        <div>
            <img id="img1" class="img-box" alt="" >
            <input type="file" id="file" onchange="loadImg(event)"><br>
        </div>
    </div>
    <div class=content2>
        <!-- <input type="text" id="imgs"><br> -->
        <!-- <label for="">writer</label><br>
        <input type="text" id="writer" placeholder="작가의 이름을 작성해주세요"><br> -->
        <label for="">title</label><br>
        <input type="text" id="title"placeholder="제목을 작성해주세요"><br>
        <label for="">content</label><br>
        <!-- <input type="text" id="content"placeholder="내용을 작성해주세요"><br> -->
        <textarea class="con_write" name="" id="content" cols="50" rows="5"placeholder="내용을 작성해주세요"></textarea>
        <label for="">page</label><br>
        <input type="text" id="page"placeholder="페이지의 수를 작성해주세요"><br>
        <div>
            <span>genre : </span>
            <select id="genre">
                <option value="conan">conan</option>
                <option value="fantasy">fantasy</option>
                <option value="game">game</option>
                <option value="horror">horror</option>
                <option value="romance">romance</option>
                <option value="sorim">sorim</option>
            </select>
        </div>
        <br>
        <label for="date">publish: <br>
            <input id="publish" type="date"
            id="date"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
            max="2100-06-20"
            min="1500-06-05"
            value="2023-06-10">
        </label> <br>
        <button id="uploadBtn" type="button">등록하기</button>
    </form>
</div>
    </div>
    
</body>
<script src="./js/address.js"></script>
<script>

    logout.onclick = async ()=>{
      
      await axios.get(`${backend}/logout`,{
        withCredentials:true,  
      })

      document.cookie = 'mytoken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/';
      window.location.href=`${frontend}index.html`;
    }
    

    uploadBtn.onclick = () => {

        console.log("uploadBtn 클릭?")
        const form = new FormData();
        form.append('upload', file.files[0]);
        if(file.files.length==0){
            alert("책 표지를 넣어주세요")
        }
        form.append('title', title.value);
        if(!title.value ){
            alert("제목을 입력해주세요")
        }
        // form.append('writer', writer.value);
        // if(!writer.value){
        //     alert("작가를 입력해주세요")
        // }
        form.append('content', content.value);
        if(!content.value){
            alert("내용를 입력해주세요")
        }
        form.append('genre', genre.options[genre.selectedIndex].value);
        form.append('page', page.value);
        form.append('publish', publish.value);
        axios.post(`${backend}/books`, form, {
            withCredentials: true,
            'Content-Type': 'multipart/form-data'
        }).then((e) => {
            console.log('잘 전달됨');
            console.log(e);

            if(e.data =="여기 완!"){
                window.location.href=`${frontend}index.html`;
            }
        
        }).catch((err) => {
            console.log("=================================================")
            console.log(err);
        })
        if(file.files.length==0){
            alert("책 표지를 넣어주세요")
        }

    }
    function loadImg(event) {
    let input = event.target;
    if (input.files && input.files[0]) {
      let reader = new FileReader();
      
      reader.onload = function(e) {
        document.getElementById('img1').src = e.target.result;
      }
      
      reader.readAsDataURL(input.files[0]);
    }
  }
</script>

</html>