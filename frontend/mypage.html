<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,500&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/font/Nanum_Myeongjo/NanumMyeongjo-ExtraBold.ttf">
    <link rel="stylesheet" href="./css/mypage.css">
   
</head>

<body>
    <div class="header">
        
        <img class="header-img"
        src="https://cdn.discordapp.com/attachments/1114103044242677824/1115109195503648838/White_logo_-_no_background.png"
            alt="">
    <div class="ulheader">
        <ul style="display: flex; align-items: center;">
            <li class="category"><a href="http://127.0.0.1:5500/frontend/checklist.html">Home</a></li>
            <li class="category"><a href="">My Books</a></li>
        </ul>
        <ul style="display: flex; align-items: center;">
            <li class="category"><a href="">Log-Out</a></li>
        </ul>
    </div>
    </div>
    <div class="main">
        <div class="content1">
            <h3 class="margin1">change profile</h3>
            <input class="margin1" type="file" id="file" onchange="loadImg(event)" style=" width: 200px;">
            <button id="uploadBtn" class="button">change</button>
            <form action="http://127.0.0.1:8080/mypages/nick" method="post">
                <h3  class="margin1">change nickname</h3>
                <input class="margin1" type="text" name="changenick">
                <button class="button" id="nickBtn">change</button>
            </form>
        </div>
        <div class="content2">
        <div>
            <span class="margin1" style="font-weight: 600;" id="nickname2"></span>'s mypage
        </div>
            <div style="display: flex;justify-content: space-around;">
                <img id="img1" class="img-box" alt="">
            </div>
            <div class="id-info">
                <span>ID : </span>
                <span id="userId"></span>
            </div>
            <div>
                <a class="my-info" href="">Edit information</a>
                <a class="my-comment" href="">comment written by me</a>
            </div>
            <h3>information</h3>
            <div class="info">
                <span>nickname : </span>
                <span id="nickname1"></span>
            </div>
            <span class="block"></span>
            <div class="info">
                <span>gender : </span>
                <span id="gender1"></span>
            </div>
            <span class="block"></span>
            <div class="info">
                <span>age : </span>
                <span id="age1"></span>
            </div>
            <span class="block"></span>
            <div class="info">
                <span>grade : </span>
                <span id="grade1"></span>
            </div>
            <span class="block"></span>
            <div class="info">
                <span>❤️ : </span>
                <span id="checks"></span>
            </div>

        </div>
        <div class="comments"><h3 class="margin1">comments</h3>
            
            <ul id="reviewList">
            </ul>
        </div>
    </div>

</body> 
<script>
    async function getAPI() {
          try {
              const {data} = await axios.get(
                  "http://127.0.0.1:8080/mypages",
                  { withCredentials: true }
                  );
                img1.src=`http://127.0.0.1:8080/${data.user_img}`
                nickname1.innerHTML=data.nickname
                nickname2.innerHTML=data.nickname
                gender1.innerHTML=data.gender
                age1.innerHTML = data.age
                grade1.innerHTML = data.grade
                checks.innerHTML = data.checks
                userId.innerHTML = data.user_id
        }
         catch (error) {
            console.log(error);
        }
    }
     getAPI();
    uploadBtn.onclick = () => {
        console.log("나 클릭?")
        const form = new FormData();
        form.append('img1', img1.value);
        form.append("user_id", 2)
        console.log(img1.value)
        form.append('upload', file.files[0]);
        console.log(file.files[0])
        axios.post('http://127.0.0.1:8080/mypages', form, {
            withCredentials: true,
            'Content-Type': 'multipart/form-data'
        }).then((e) => {
            console.log('잘 전달됨');
            console.log(e);

        }).catch((err) => {
            console.log("=================================================")
            console.log(err);
        })
    }
    nickBtn.onclick = ()=>{
        try {
        console.log("닉버튼 찍힘?")  
        window.location.reload();
        
    } catch (error) {
        console.log("여기 nick ERR")
        console.log(error)
    }
    }
    let myComment = document.querySelector('.my-comment')
    let comments = document.querySelector('.comments')
    myComment.addEventListener('click',function(e){
        console.log("댓글 클릭?")
        e.preventDefault()
        if(comments.style.display==='none'){
            comments.style.display ='block'
        }else{
            comments.style.display='none'
        }
    })
    let myinfo = document.querySelector(".my-info") 
    let profile = document.querySelector(".content1")
    myinfo.addEventListener('click',function(e){
        console.log("정보 수정 클릭?")
        e.preventDefault()
        if(profile.style.display==='none'){
            profile.style.display='block'
        }else{
            profile.style.display='none'
        }
    })

    async function reviewAPI(){
        try {
            const {data}= await axios.get('http://127.0.0.1:8080/mypages/reviews',{
                withCredentials :true})
                console.log(data)
               data.forEach((el) => {
                reviewList.innerHTML +=`
                <div class="comment-box" >
                <li>
            <div>title :  </div>
            <div>comment : ${el.comment} </div>
            <div>star⭐ : ${el.star} </div>
                </li>
                </div>
                `
               });
        } catch (error) {
            
        }
    }
    reviewAPI()
    
    function loadImg(event) {
    let input = event.target;
    if (input.files && input.files[0]) {
      let reader = new FileReader();
      
      reader.onload = function(e) {
        document.getElementById('img1').src = e.target.result;
      } 
      
      reader.readAsDataURL(input.files[0]);
    }
  }

</script>

</html>