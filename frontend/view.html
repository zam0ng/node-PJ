<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./css/index.css" />
    <link rel="stylesheet" href="./css/view.css" />
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div id ="isLoading">
      <img src="http://13.209.64.80/img/boxloading.gif" alt="">
    </div>
     <!-- Î°úÍ≥† Î∂ÄÎ∂Ñ -->
     <div class="nav">
      <div class="logoBox">
        <a href="/index.html"
          ><img src="http://13.209.64.80/img/Black logo - no background.png" alt=""
        /></a>

        <div class="functionBox">
          <span id="insert"
            ><a href="/books.html"
              >‚úèÔ∏è writing</a
            ></span
          >
          <span id="allview">üìôbooks</span>
          <!-- Ï∂îÎ¶¨, Í≥µÌè¨‚Ä¢Ïä§Î¶¥Îü¨, ÌåêÌÉÄÏßÄ, Î¨¥Ìòë, Í≤åÏûÑ ,Î°úÎß®Ïä§ -->
          <a href=""><span id="nick"></span></a>
          <span id="login"
            ><a href="/login.html">
              login</a
            ></span
          >
          <span id="signUp"
            ><a href="/signup.html">
              signUp</a
            ></span
          >
          <button id="logout">logout</button>
        </div>
      </div>
      <div class="toggle">
        <div class="genre">
          <span id="all"
            ><a href="/genre/all.html"
              >Ï†ÑÏ≤¥</a
            ></span
          >
          <span id="conan"
            ><a href="/genre/conan.html"
              >Ï∂îÎ¶¨</a
            ></span
          >
          <span id="horror"
            ><a href="/genre/horror.html"
              >Í≥µÌè¨‚Ä¢Ïä§Î¶¥Îü¨</a
            ></span
          >
          <span id="fantasy"
            ><a href="/genre/fantasy.html"
              >ÌåêÌÉÄÏßÄ</a
            ></span
          >
          <span id="sorim"
            ><a href="/genre/sorim.html"
              >Î¨¥Ìòë</a
            ></span
          >
          <span id="game"
            ><a href="/genre/game.html"
              >Í≤åÏûÑ</a
            ></span
          >
          <span id="romance"
            ><a href="/genre/romance.html"
              >Î°úÎß®Ïä§</a
            ></span
          >
        </div>
      </div>
    </div>

    <!-- ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ -->
    <div class="viewWrap">
      <!-- ÏôºÏ™Ω Ï±ÖÌëúÏßÄ, Ï∞ú -->
      <div class="sideSticky">
        <div class="sideWrap">
          <!-- Ï±Ö ÌëúÏßÄ ÎÇòÏò§Îäî Í≥≥ -->
          <img class="sideWrapImg" src="" />
          <div class="sideWrapBtn">
            <div class="buyprice">
              <span>‚Ç©</span>
              <span id="buyprice_span"></span>
            </div>
            <div class="wantToReadBtn">
              <span id="checks">‚ô°</span>
            </div>
            <div class="BuyTheBookBtn">
              <span id="buyspan">Buy The Book</span>
            </div>
            <!-- Ïö∞Ï∏° ÏÇ¨Ïù¥Îìú Î≥ÑÏ†ê ÏùºÎã® Î≥¥Î•ò -->
            <!-- <div class="bookStars">
              <div class="bookStarEmpty">
                <span>‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
              </div>
              <div class="bookStarFull">
                <span>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
              </div>
            </div> -->
          </div>
        </div>
      </div>
      <!-- ÏôºÏ™Ω Ï±ÖÌëúÏßÄ, Ï∞ú end -->

      <!-- Ïò§Î•∏Ï™Ω ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ Î≥∏Î¨∏ -->
      <div class="viewMainWrap">
        <div class="viewMainText">
          <!-- Ï±Ö Ï†úÎ™© Ï∂úÎ†• -->
          <h1></h1>
          <!-- ÏßÄÏùÄÏù¥ Ï∂úÎ†• -->
          <span></span>

          <!-- Î≥ÑÏ†ê, Ï°∞ÌöåÏàò, Î¶¨Î∑∞Ïàò -->
          <div class="communityCollection">
            <div class="collectionStar">
              <div class="colStars">
                <div class="colStarEmpty">
                  <span>‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
                </div>
                <div class="colStarFull">
                  <span>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                </div>
              </div>
              <div class="colStarAvg">
                <span>${}</span>
              </div>
            </div>

            <div class="colRatingsReviews">
              <span>${Ï°∞ÌöåÏàò} ratings, ${ÎåìÍ∏ÄÏàò} reviews</span>
            </div>
          </div>
          <!-- Î≥ÑÏ†ê, Ï°∞ÌöåÏàò, Î¶¨Î∑∞Ïàò end -->
          <!-- Ï±Ö ÎÇ¥Ïö© Ï∂úÎ†• -->
          <div class="textContainer">
            <p>
              What if your worst enemy was your only hope? <br />

              When a fifteen-year-old girl fails to make it home after school,
              DI Heather Filson believes she‚Äôs dealing with just another teenage
              runaway.
            </p>
          </div>
          <!-- Ï±Ö ÎÇ¥Ïö© end -->

          <!-- Ïû•Î•¥ -->
          <div class="genres">
            <span>Genre : </span>
            <!-- ÏïÑÎûòÎ∂ÄÌÑ∞ Ïû•Î•¥ Î∞õÏïÑÏò§Í∏∞ -->
            <span></span>
          </div>
          <!-- Ïû•Î•¥ end -->

          <!-- Ï±Ö ÌéòÏù¥ÏßÄÏàò -->
          <div class="bookpage">
            <!-- Ïó¨Í∏∞Ïóê ÌéòÏù¥ÏßÄ Ïàò Î∞õÏïÑÏò§Í∏∞ -->
            <span></span>
            <span>Pages</span>
          </div>
          <!-- Ï±Ö ÌéòÏù¥ÏßÄÏàò end -->

          <!-- Ï∂úÌåêÏùº -->
          <div class="bookpublish">
            <span>First published</span>
            <!-- Ïó¨Í∏∞Ïóê Ï∂úÌåê ÎÇ†Ïûê Î∞õÏïÑÏò§Í∏∞ -->
            <span>May 19, 2023</span>
          </div>
        </div>
        <!-- Ï∂úÌåêÏùº end -->

        <!-- people currently reading & people want to read -->
        <div class="peopleWrap">
          <!-- people currently reading -->
          <div class="currentlyWrap">
            <div class="peopleContainer">
              <img class="buypeopleImg" src="http://13.209.64.80/img/basic.png" />
              <img class="buypeopleImg" src="http://13.209.64.80/img/basic.png" />
              <img class="buypeopleImg" src="http://13.209.64.80/img/basic.png" />
              <span id="buypeoplecnt">100</span>
              <span> people are currently reading</span>
            </div>
          </div>
          <!-- people want to read -->
          <div class="readWrap">
            <div class="peopleContainer">
              <img class="checkspeopleImg" src="http://13.209.64.80/img/basic.png" />
              <img class="checkspeopleImg" src="http://13.209.64.80/img/basic.png" />
              <img class="checkspeopleImg" src="http://13.209.64.80/img/basic.png" />
              <span id ="checkpeoplecnt">100 </span>
              <span>people want to read</span>
            </div>
          </div>
        </div>
        <!-- people currently reading & people want to read end -->

        <!-- About the author -->
        <div class="authorContainer">
          <h2>About the author</h2>
          <!-- ÏûëÍ∞Ä Ïù¥ÎØ∏ÏßÄ, Ïù¥Î¶Ñ, ÌåîÎ°úÏö∞ Î≤ÑÌäº -->
          <div class="authorWrap">
            <div class="authorImg">
              <img
                src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/authors/1586076388i/19106689.jpg"
                alt=""
              />
            </div>
            <div class="authorName">
              <span>JD Kirk</span>
              <span>26 books, 876 followers</span>
            </div>
            <div class="authorFollow">
              <div class="followBtn">
                <span class="ft">Follow</span>
              </div>
            </div>
          </div>
          <!-- ÏûëÍ∞Ä ÌîÑÎ°úÌïÑ ÌÖçÏä§Ìä∏ -->
          <!-- <div class="authorProfile">
            <p>
              JD Kirk is the pen name of multi-award-winning author,
              screenwriter, and writer of comics, Barry Hutchison.<br /><br />
            </p>
          </div> -->
        </div>
        <!-- About the author end -->

        <!-- Ratings & Reviews -->
        <div class="reviewContainer">
          <h2>Ratings & Reviews</h2>
          <!-- ÏûëÍ∞Ä Ïù¥ÎØ∏ÏßÄ, Ïù¥Î¶Ñ, ÌåîÎ°úÏö∞ Î≤ÑÌäº -->
          <div class="reviewWrap">
            <div class="myImg">
              <!-- <img src="http://13.209.64.80/img/basic.png" alt="" /> -->
            </div>
            <div class="reivewForm">
              <div class="reviewStars">
                <div class="reviewStar"><span>‚òÜ</span></div>
                <div class="reviewStar"><span>‚òÜ</span></div>
                <div class="reviewStar"><span>‚òÜ</span></div>
                <div class="reviewStar"><span>‚òÜ</span></div>
                <div class="reviewStar"><span>‚òÜ</span></div>
              </div>
              <div class="writeReviewContainer">
                <input type="text" name="" id="" />
              </div>
            </div>
            <div class="reviewPost">
              <div class="postBtn">
                <span>post</span>
              </div>
            </div>
          </div>
        </div>
        <!-- Ratings & Reviews end -->

        <!-- Community Reviews -->
        <div class="communityReviewsContainer">
          <h2>Community Reviews</h2>
          <!-- Î≥ÑÏ†ê, Ï°∞ÌöåÏàò, Î¶¨Î∑∞Ïàò -->
          <!-- <div class="communityCollection">
            <div class="collectionStar">
              <div class="colStars">
                <div class="colStarEmpty">
                  <span>‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
                </div>
                <div class="colStarFull">
                  <span>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                </div>
              </div>
              <div class="colStarAvg">
                <span>${}</span>
              </div>
            </div>

            <div class="colRatingsReviews">
              <span>${Ï°∞ÌöåÏàò} ratings, ${ÎåìÍ∏ÄÏàò} reviews</span>
            </div>
          </div> -->

          <!-- Î≥ÑÏ†ê bar -->
          <div class="ratingsContainer">
            <!-- Î≥ÑÏ†ê 5Ï†ê -->
            <div class="ratingsWrap">
              <div class="ratingsNum"><span>5 stars</span></div>
              <div class="ratingsBar">
                <div class="ratingsBarInner">
                  <div class="emptyBar"></div>
                  <div class="fullBar"></div>
                </div>
              </div>
              <div class="ratingsTotal">
                <span>0 (0%)</span>
              </div>
            </div>

            <!-- Î≥ÑÏ†ê 4Ï†ê -->
            <div class="ratingsWrap">
              <div class="ratingsNum"><span>4 stars</span></div>
              <div class="ratingsBar">
                <div class="ratingsBarInner">
                  <div class="emptyBar"></div>
                  <div class="fullBar"></div>
                </div>
              </div>
              <div class="ratingsTotal">
                <span>0 (0%)</span>
              </div>
            </div>

            <!-- Î≥ÑÏ†ê 3Ï†ê -->
            <div class="ratingsWrap">
              <div class="ratingsNum"><span>3 stars</span></div>
              <div class="ratingsBar">
                <div class="ratingsBarInner">
                  <div class="emptyBar"></div>
                  <div class="fullBar"></div>
                </div>
              </div>
              <div class="ratingsTotal">
                <span>0 (0%)</span>
              </div>
            </div>

            <!-- Î≥ÑÏ†ê 2Ï†ê -->
            <div class="ratingsWrap">
              <div class="ratingsNum"><span>2 stars</span></div>
              <div class="ratingsBar">
                <div class="ratingsBarInner">
                  <div class="emptyBar"></div>
                  <div class="fullBar"></div>
                </div>
              </div>
              <div class="ratingsTotal">
                <span>0 (0%)</span>
              </div>
            </div>

            <!-- Î≥ÑÏ†ê 1Ï†ê -->
            <div class="ratingsWrap">
              <div class="ratingsNum"><span>1 stars</span></div>
              <div class="ratingsBar">
                <div class="ratingsBarInner">
                  <div class="emptyBar"></div>
                  <div class="fullBar"></div>
                </div>
              </div>
              <div class="ratingsTotal">
                <span>0 (0%)</span>
              </div>
            </div>
          </div>
          <!-- Î≥ÑÏ†ê bar end -->

          <!-- reviews area -->
          <div class="commentContainer">
            <p class="commentContainerReviewCnt">Displaying 1 - 10 of 84 reviews</p>
            <!-- ÎåìÍ∏Ä Ï†ÑÏ≤¥ Í∞êÏã∏Îäî div -->
            <!-- <div class="commentWrap">
              <div class="commentProfile">
                <div class="commentProfileImg">
                  <img src="./img/basic.png" alt="" />
                </div>
                <div class="commentProfileInfo">
                  <span>name</span>
                  <span>author & not</span>
                  <span>2 books & reviews</span>
                  <span>101 followers</span>
                </div>
                <div class="commentProfileFollowbtn">
                  <span>Follow</span>
                </div>
              </div>
              <div class="commentMainWrap">
                <div class="commentMainHeader">
                  <div class="commentMainStar">
                    <span>‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
                  </div>
                  <div class="commentMainDate">
                    <span>May 30, 2023</span>
                  </div>
                </div>
                <div class="commentArea">
                  <p>
                    
                  </p>
                </div>
                <span class="r_reviewOpen">1 comments</span>
                <div class="reCommentArea">

                  <div class="reCommentsWrap">
                    <div class="reCommentsInner">
                      <div class="reCommentsProfileImgs">
                        <img src="./img/basic.png" alt="" />
                      </div>
                      <div class="reComments">
                        <span>name</span>
                        <span>recomments</span>
                      </div>
                    </div>


                    <div class="reCommentInput">
                      <div class="reCommentMyimg">
                        <img src="./img/basic.png" alt="" />
                      </div>
                      <input type="text" />
                      <div class="reCommentBtn">
                        <span>post</span>
                      </div>
                    </div>
                  </div>
                  
                </div>
                
              </div>
            </div> -->
            
 
            </div>
          </div>
          <!-- reviews area end -->
        </div>
        <!-- Community Reviews end -->
      </div>
      <!-- Ïò§Î•∏Ï™Ω ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ Î≥∏Î¨∏ end -->
    </div>
    <!-- ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ end -->
  </body>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="./genre/genre.js"></script>
  <script src="./js/view.js"></script>
  <script>

async function logincheck2() {
  const data = await axios.get(`${backend}/main/viewcheck`, {
    // Ïù¥Í≤å rawheaderÏóê Ïø†ÌÇ§Î•º Ï†ÄÏû•ÌïòÎäî Ïó≠Ìï†
    withCredentials: true,

    //  : {token : at, jojojojojojoj : "kjiljlkjlkjkl"},
  });

  if(data.data=="unde"){
      alert("Î°úÍ∑∏Ïù∏ ÌõÑ Ïù¥Ïö©Ìï¥Ï£ºÏÑ∏Ïöî!„Öé„Öé");
      window.location.href = `${frontend}login.html`;
      return;
    }
  else{
    return;
  }
  }
  // onload ÎêòÏóàÏùÑ Îïå Ïú†Ï†Ä checksÎ•º ÌôïÏù∏Ìï¥ÏÑú Ïù¥ ÌéòÏù¥ÏßÄÏùò ÏïÑÏù¥ÎîîÍ∞Ä ÏûàÏúºÎ©¥
  // ÌïòÌä∏Í∞Ä ÎàåÎ†§Ï†∏ÏûàÍ≤å ÌëúÏãúa
  window.onload = async () => {
    
      const followBtn = document.querySelector(".followBtn");
      const ft = document.querySelector(".ft");

      const getUrl = new URL(window.location.href);

      const getParams = new URLSearchParams(getUrl.search);

      const getId = getParams.get("id");

      const data1 = await axios.get(`${backend}/view/user/checks`, {
        withCredentials: true,
      })
      const teststr = data1.data.checks;

      if (teststr != null) {

        const tta = teststr.split(",");

        tta.forEach((el) => {
          if (el == getId) {

            checks.innerHTML = "‚ô•";

          }
        });
      }
      // ÌéòÏù¥ÏßÄÏóê Îì§Ïñ¥Ïò¨ ÎñÑ viewcnt Ï¶ùÍ∞Ä
      await axios.get(`${backend}/view/checks/viewcnt/${getId}`, {
        withCredentials: true,
      });

      //„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°„Ö°
      // view ÌéòÏù¥ÏßÄÏóê Îì§Ïñ¥ÏôîÏùÑÎïå Ìï¥ÎãπÏûëÍ∞ÄÎ•º ÌåîÎ°úÏö∞ Ìïú ÏÉÅÌÉúÏù¥Î©¥ follow Î≤ÑÌäºÏù¥ white Î°ú Î≥¥Ïù¥Í≤å
      // user ÏóêÏÑú ÌåîÎ°úÏûâ Í∞í Í∞ÄÏ†∏ÏôÄÏÑú split ÏúºÎ°ú ÏßúÎ•¥Í≥† Î∞∞Ïó¥ ÎßåÎì†ÌõÑÏóê ÏûëÍ∞Ä id Îûë ÎπÑÍµêÌï¥ÏÑú ÎßûÏúºÎ©¥ 
      // follow Î≤ÑÌäº Ìù∞ÏÉâ
      const data2 = await axios.get(`${backend}/view/user/follow`, {
        withCredentials: true,
      })
      const f = data2.data.following;
      const data = await booksAllData();
      const author = data.data.bookdata;
      
      if (f != null) {
        const ff = f.split(",");

        ff.forEach((el) => {
          if (el == author.id) {

            followBtn.style.backgroundColor = "white";
            ft.style.color = "black"
            ft.innerText = "Following"
          }
        });
      }

      // ÌåîÎ°úÏö∞ Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌñàÏùÑ Îïå Í∑∏ ÏïàÏóê text Í∞Ä following Ïù¥Î©¥ 
      // User Í∞ÄÏ†∏ÏôÄÏÑú Ìï¥Îãπ ÏûëÍ∞ÄÎ≤àÌò∏ ÏßÄÏö∞Í≥† ÏóÖÎç∞Ïù¥Ìä∏

      followBtn.onclick = async () => {
        logincheck2();
        if (ft.innerText == "Following") {
          await axios.get(`${backend}/follow/del`, {
            withCredentials: true,


            params: {
              author_id: author.id,
            }
          })
          followBtn.style.backgroundColor = "black";
          ft.style.color = "white"
          ft.innerText = "Follow"
        }

        if (ft.innerText == "Follow") {

          await axios.get(`${backend}/follow/list`, {
            withCredentials: true,

            params: {
              author_id: author.id,
            }
          });

          followBtn.style.backgroundColor = "white";
          ft.style.color = "black"
          ft.innerText = "Following"
        }
      }
      //console.log(author);
      //console.log(author.Books)
      const bookInfo = author.Books;
      //console.log(bookInfo[0].id);
      //console.log("------------author");
      const bookNum = bookInfo[0].id;
      const price = await axios.get(`${backend}/view/how/price`, {
        withCredentials: true,

        params :{
          id : bookNum
        }
      });

      //console.log(price);

      buyprice_span.innerText = price.data;

      // Ï±Ö Íµ¨Îß§Ìïú ÏÇ¨Îûå, Ï∞úÌïú ÏÇ¨Îûå Ïàò
      // buypeoplecnt
      // checkpeoplecnt
      const buypeopleImg =document.querySelectorAll(".buypeopleImg");
      const checkspeopleImg=document.querySelectorAll(".checkspeopleImg");
      //0625
      const buycnt2 = await axios.get(`${backend}/view/buy/cnt`, {
        withCredentials: true,

        params :{
          id : bookNum,
        }
      });
      
      const buycnt = await axios.get(`${backend}/view/buy/cnt`, {
        withCredentials: true,

        params :{
          id : bookNum,
        }
      });
      
      buycnt.data.forEach((el,index) => {

        buypeopleImg[index].src = el.user_img;
      });
      //0625
      buypeoplecnt.innerText= buycnt2.data.length;

      const checkscnt = await axios.get(`${backend}/view/checks/cnt`, {
        withCredentials: true,

        params :{
          id : bookNum,
        }
      });
      let arr = [];
      for (let index = 0; index < 3; index++) {
        arr.push(Math.floor(Math.random()*checkscnt+1));
      }

      arr.forEach((el,index) => {
        checkspeopleImg[index].src = checkscnt[el].user_img;
      });

      checkpeoplecnt.innerText = checkscnt.data.length;


      //buyspan
      // Ï±Ö Î≤àÌò∏ Í∞ÄÏ†∏ÏôÄÏÑú Ïú†Ï†Ä ÌÖåÏù¥Î∏îÏóêÏÑú ÏûàÎäîÏßÄ Ï°∞ÌöåÌïòÍ≥† ÏûàÏúºÎ©¥ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî / innertext = thank you
      const buycheck = await axios.get(`${backend}/view/checks/buys/${getId}`,{
        withCredentials:true,
      })
      console.log(buycheck.data)
      if(buycheck.data=="relogin"){
        buycheck.data=null;
      }
      console.log("----------------buycheck.data")
      if(buycheck.data!=null){
        const BuyTheBookBtn = document.querySelector(".BuyTheBookBtn");
        buyspan.innerText = "thank you üëç";
        BuyTheBookBtn.onclick =  (e) => {
          e.preventDefault();
        }
      }

      // onload ÎÅù
    isLoading.classList.add("disable");

    }
    
    const wantToReadBtn = document.querySelector(".wantToReadBtn");

// want to read ÎàåÎ†ÄÏùÑ Îïå Ïú†Ï†ÄÏùò checks Ïóê book title Ïù¥ Îã¥Í∏∞ÎèÑÎ°ù
wantToReadBtn.onclick = async() =>{
  logincheck2();
  // ÌòÑÏû¨ urlÏóê ÏûàÎäî idÏùò Í∞íÏùÑ Í∞ÄÏ†∏Ïò¥
  const getUrl = new URL(window.location.href);
  
  const getParams = new URLSearchParams(getUrl.search);

  const getId = getParams.get("id");

  
  if(checks.innerHTML == "‚ô•"){
    checks.innerHTML = "‚ô°"
    //console.log("Ï∞ú Ìï¥Ï≤¥Ìï†Í±∞ÏûÑ")
    const data = await axios.get(`${backend}/view/checks/delete/${getId}`, {
    withCredentials: true,
  });
  } else {
    checks.innerHTML = "‚ô•"
    //console.log("Ï∞ú Ìï†Í±∞ÏûÑ")
    const data = await axios.get(`${backend}/view/checks/add/${getId}`, {
    withCredentials: true,
  });
  } 

}
</script>

  
</html>
